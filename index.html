<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frosted Glass Live Chat</title>

<style>
:root{
--glass: rgba(255,255,255,0.12);
--border: rgba(255,255,255,0.25);
--blur: blur(18px);
--me: linear-gradient(135deg,#60a5fa,#2563eb);
--other: rgba(255,255,255,0.18);
--text:#fff;
}

*{box-sizing:border-box}

body{
margin:0;
height:100vh;
background:
radial-gradient(circle at top,#1e3a8a,#020617 70%);
font-family:system-ui,-apple-system;
display:flex;
justify-content:center;
align-items:center;
color:var(--text);
}

.app{
width:100%;
max-width:420px;
height:100vh;
display:flex;
flex-direction:column;
background:var(--glass);
backdrop-filter:var(--blur);
border:1px solid var(--border);
box-shadow:
0 30px 60px rgba(0,0,0,.6),
inset 0 1px 1px rgba(255,255,255,.2);
  position:relative;
}

/* HEADER */
.header{
padding:14px;
display:flex;
justify-content:space-between;
align-items:center;
background:rgba(255,255,255,.08);
border-bottom:1px solid var(--border);
}

.header span{
font-weight:600;
}

#online{
font-size:12px;
color:#22c55e;
}

/* CHAT */
#chat{
flex:1;
overflow-y:auto;
padding:14px;
display:flex;
flex-direction:column;
gap:10px;
}

.msg{
max-width:78%;
padding:10px 12px;
border-radius:14px;
font-size:14px;
position:relative;
backdrop-filter:blur(10px);
box-shadow:0 8px 20px rgba(0,0,0,.3);
}

.me{
align-self:flex-end;
background:var(--me);
}

.other{
align-self:flex-start;
background:var(--other);
}

.meta{
font-size:10px;
opacity:.8;
text-align:right;
margin-top:4px;
}

.delete{
position:absolute;
top:4px;
right:6px;
font-size:10px;
cursor:pointer;
opacity:.7;
}

img{
max-width:100%;
border-radius:10px;
margin-top:6px;
}

/* TYPING */
#typing{
font-size:12px;
padding:6px 14px;
opacity:.7;
}

/* INPUT */
.input{
display:flex;
gap:6px;
padding:12px;
background:rgba(255,255,255,.06);
border-top:1px solid var(--border);
  position: fixed;
      bottom: 0;
    width: 100%;
}

input{
flex:1;
padding:10px;
border:none;
border-radius:10px;
outline:none;
background:rgba(255,255,255,.18);
color:white;
}

button{
padding:10px 14px;
border:none;
border-radius:10px;
cursor:pointer;
background:linear-gradient(135deg,#38bdf8,#2563eb);
color:white;
box-shadow:0 4px 15px rgba(0,0,0,.4);
}

</style>
</head>
<body>

<div class="app">
  <div class="header">
    <span>Live Chat</span>
    <span id="online">0 online</span>
  </div>

  <div id="chat"></div>
  <div id="typing"></div>

  <div class="input">
    <input id="msg" placeholder="Type messageâ€¦" />
    <input type="file" id="img" hidden>
    <button onclick="img.click()">ðŸ“Ž</button>
    <button onclick="send()">Send</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
getDatabase, ref, push, onChildAdded,
onValue, set, remove, update, onDisconnect
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

/* ðŸ”¥ YOUR FIREBASE CONFIG */
const firebaseConfig = {
apiKey: "AIzaSyAXgubYgcfYsaeDcx8DuEFmYWJkJ6oz8so",
authDomain: "direct-chat-via-link.firebaseapp.com",
databaseURL: "https://direct-chat-via-link-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId: "direct-chat-via-link",
storageBucket: "direct-chat-via-link.firebasestorage.app",
messagingSenderId: "26226616717",
appId: "1:26226616717:web:89d75ac8e16d05245375c4"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* NOTIFICATIONS */
if ("Notification" in window && Notification.permission !== "granted") {
Notification.requestPermission();
}

let tabActive=true;
document.addEventListener("visibilitychange",()=>tabActive=!document.hidden);

/* USER */
let uid=localStorage.uid||crypto.randomUUID();
let name=localStorage.name||prompt("Your name?");
localStorage.uid=uid;
localStorage.name=name;

/* ROOM */
const room=new URLSearchParams(location.search).get("room")||"default";
const chatRef=ref(db,`rooms/${room}/messages`);
const presenceRef=ref(db,`rooms/${room}/presence/${uid}`);
const typingRef=ref(db,`rooms/${room}/typing/${uid}`);

/* PRESENCE */
set(presenceRef,true);
onDisconnect(presenceRef).remove();

onValue(ref(db,`rooms/${room}/presence`),s=>{
online.innerText=(s.exists()?Object.keys(s.val()).length:0)+" online";
});

/* SEND */
window.send=()=>{
if(!msg.value.trim())return;
push(chatRef,{
text:msg.value,
user:name,
uid,
time:Date.now(),
seen:false
});
msg.value="";
};

msg.oninput=()=>{
set(typingRef,name);
setTimeout(()=>set(typingRef,null),1000);
};

onValue(ref(db,`rooms/${room}/typing`),s=>{
let t=[];
s.forEach(c=>c.val()&&c.key!==uid&&t.push(c.val()));
typing.innerText=t.length?t.join(", ")+" typingâ€¦":"";
});

/* IMAGE */
img.onchange=e=>{
const r=new FileReader();
r.onload=()=>push(chatRef,{
image:r.result,user:name,uid,time:Date.now(),seen:false
});
r.readAsDataURL(e.target.files[0]);
};

/* RECEIVE */
onChildAdded(chatRef,s=>{
const m=s.val(),k=s.key;

if(m.uid!==uid){
update(ref(db,`rooms/${room}/messages/${k}`),{seen:true});
if(!tabActive&&Notification.permission==="granted"){
new Notification("New message from "+m.user,{
body:m.text||"ðŸ“· Image",
icon:"https://cdn-icons-png.flaticon.com/512/9068/9068671.png"
});
}
}

const d=document.createElement("div");
d.className="msg "+(m.uid===uid?"me":"other");
d.innerHTML=`
<b>${m.user}</b><br>
${m.text||""}
${m.image?`<img src="${m.image}">`:""}
<div class="meta">
${new Date(m.time).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}
${m.uid===uid?(m.seen?" âœ”âœ”":" âœ”"):""}
</div>
${m.uid===uid?`<div class="delete" onclick="del('${k}')">âœ–</div>`:""}
`;
chat.appendChild(d);
chat.scrollTop=chat.scrollHeight;
});

window.del=k=>remove(ref(db,`rooms/${room}/messages/${k}`));
</script>
</body>
</html>
